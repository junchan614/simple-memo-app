# ポート確認コマンドの解説

## なぜポートを確認するの？

ブラウザで `localhost:3000` にアクセスできない時、考えられる原因：

1. **サーバーが起動していない** - プログラムが動いていない
2. **ポートが開いていない** - サーバーは動いているけど、外部からアクセスできない状態
3. **別のプログラムがポートを使用中** - 他のアプリが3000番を使っている

## コマンドの意味

### `ss -tlnp | grep 3000`

#### `ss` コマンド
- **Socket Statistics** の略
- ネットワーク接続の状態を表示するコマンド
- 「今、どのポートで何が動いているか？」を調べる

#### オプションの意味
- `-t` : **TCP接続のみ**表示（ウェブサーバーはTCP）
- `-l` : **Listening状態**のみ表示（接続待ちの状態）
- `-n` : **数字で**表示（localhost→127.0.0.1、http→80など）
- `-p` : **プロセス名**も表示（どのプログラムが使っているか）

#### `| grep 3000`
- **パイプ** でssの結果をgrepに渡す
- `grep 3000` で **3000番ポートの行のみ**を抽出

### 身近な例で理解

```
マンション（コンピュータ）の各部屋（ポート）の状況確認

ss コマンド = 管理人さんの台帳確認
「今、どの部屋に誰が住んでいるか教えて」

-t : アパートのみ（一戸建ては除外）
-l : 入居者募集中の部屋のみ
-n : 部屋番号で表示（「田中さんの部屋」→「301号室」）
-p : 住民の名前も教えて

grep 3000 : 3000号室の情報のみ教えて
```

## 期待される結果

### 正常な場合
```
LISTEN  0  511  127.0.0.1:3000  0.0.0.0:*  users:(("node",pid=1234,fd=18))
```

**解読**:
- `LISTEN` : 接続待ち状態（お店が開店中）
- `127.0.0.1:3000` : localhost の3000番ポートで待機
- `node` : Node.jsプログラムが使用中
- `pid=1234` : プロセスID（プログラムの識別番号）

### 問題がある場合
```
（何も表示されない）
```
**意味**: 3000番ポートで待機しているプログラムがない

## 他の確認コマンド

### プロセス確認
```bash
ps aux | grep node
```
- 現在動いているNode.jsプロセスを確認
- サーバーが起動しているかチェック

### ポート使用状況確認
```bash
lsof -i :3000
```
- 3000番ポートを使用しているプログラムを確認
- 別のアプリが使っていないかチェック

## トラブルシューティングの流れ

### Step 1: サーバープロセス確認
```bash
ps aux | grep node
```
→ Node.jsが動いているか？

### Step 2: ポート確認
```bash
ss -tlnp | grep 3000
```
→ 3000番ポートで待機しているか？

### Step 3: 競合確認
```bash
lsof -i :3000
```
→ 他のプログラムが3000番を使っていないか？

## WSL特有の問題

WSL（Windows Subsystem for Linux）環境では：

1. **ファイアウォール問題**
   - Windowsのファイアウォールがブロック

2. **ネットワーク設定**
   - WSL内のIPアドレスとWindows側で異なる

3. **ポート転送設定**
   - 自動的にポート転送されない場合がある

## 解決方法の候補

### 1. 異なるポートで試す
```javascript
const PORT = process.env.PORT || 8080;  // 3000 → 8080
```

### 2. 全てのインターフェースでListenする
```javascript
app.listen(PORT, '0.0.0.0', () => {  // '0.0.0.0' を追加
    console.log(`Server running on port ${PORT}`);
});
```

### 3. WSLのIPアドレスを確認
```bash
ip addr show eth0
```

このコマンドでWSL内でのサーバーの状態を詳しく調べられます！