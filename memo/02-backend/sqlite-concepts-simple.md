# SQLite超わかりやすい解説 - 高校生向け

## SQLiteって何？

**簡単に言うと**: デジタルの「整理整頓された引き出し」です！

普通のファイル（.txtや.docx）は「1つの紙の束」みたいなものですが、
データベースは「たくさんの引き出しがある整理タンス」のようなものです。

## 身近な例で理解しよう

### 📚 学校の図書館で例えると...

#### 普通のファイル（.txt）= 1冊のノート
```
ノート1冊の中に全部書く:
- 1ページ目: 田中さん、数学、90点
- 2ページ目: 佐藤さん、英語、85点
- 3ページ目: 山田さん、数学、78点
...

問題点:
- 「数学のテストの結果だけ見たい」→ 全部読み返す必要がある
- 「田中さんの成績を変更したい」→ 探すのが大変
- 「新しい教科を追加したい」→ 全体の構造を変える必要がある
```

#### SQLite = 整理整頓された図書館
```
📋 貸出管理システム

┌─────────────────────────────────────┐
│           図書館データベース          │
│                                   │
│  📚 本の情報テーブル                 │
│  ┌────┬──────────┬──────┬────────┐  │
│  │ID  │   タイトル    │ 著者  │  年度  │  │
│  ├────┼──────────┼──────┼────────┤  │
│  │ 1  │ 数学入門     │田中  │  2023  │  │
│  │ 2  │ 英語基礎     │佐藤  │  2022  │  │
│  │ 3  │ 物理学      │山田  │  2024  │  │
│  └────┴──────────┴──────┴────────┘  │
│                                   │
│  👤 会員情報テーブル                 │
│  ┌────┬──────┬────────┬────────┐     │
│  │ID  │ 名前  │  学年   │ 電話番号 │     │
│  ├────┼──────┼────────┼────────┤     │
│  │ 1  │鈴木  │   高1   │090-xxxx│     │
│  │ 2  │高橋  │   高2   │080-yyyy│     │
│  └────┴──────┴────────┴────────┘     │
└─────────────────────────────────────┘

利点:
- 「数学の本だけ見たい」→ 瞬時に検索可能
- 「鈴木さんの電話番号を変更」→ その部分だけ更新
- 「新しい会員を追加」→ 簡単に1行追加
```

## SQLiteの特徴

### 1. ファイル型データベース = 「持ち運び可能な整理箱」

#### 一般的なデータベース（MySQL等）
```
🏢 大型図書館（サーバーが必要）

┌─────────────────────────────────────┐
│          専用サーバー                │
│                                   │
│  • 24時間稼働が必要                  │
│  • 専門の管理者が必要                │
│  • 複雑な設定が必要                  │
│  • でも大勢が同時アクセス可能         │
└─────────────────────────────────────┘
```

#### SQLite
```
📦 整理ボックス（ファイル1個）

┌─────────────────────────────────────┐
│        memo_app.db (1つのファイル)     │
│                                   │
│  • USBに入れて持ち運び可能            │
│  • 設定不要ですぐ使える               │
│  • 小〜中規模に最適                  │
│  • でも大勢の同時アクセスは苦手        │
└─────────────────────────────────────┘
```

### 2. SQL = 「図書館との会話言語」

**SQL**（Structured Query Language）= データベースとの共通語

#### 日本語での依頼
```
司書さん:
- 「数学の本を全部見せて」
- 「鈴木さんの新しい本を貸出記録に追加して」
- 「山田さんの電話番号を090-1234-5678に変更して」
- 「ID番号3の本を削除して」
```

#### SQLでの依頼
```sql
-- 「数学の本を全部見せて」
SELECT * FROM books WHERE subject = '数学';

-- 「鈴木さんの新しい本を貸出記録に追加して」
INSERT INTO rentals (member_name, book_id) VALUES ('鈴木', 1);

-- 「山田さんの電話番号を変更して」
UPDATE members SET phone = '090-1234-5678' WHERE name = '山田';

-- 「ID番号3の本を削除して」
DELETE FROM books WHERE id = 3;
```

## メモアプリでの使い方

### 今回作るテーブル構造

```sql
CREATE TABLE memos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,  -- ID番号（自動採番）
    title TEXT NOT NULL,                   -- タイトル（必須）
    content TEXT,                          -- 内容（任意）
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,  -- 作成日時
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP   -- 更新日時
);
```

#### 実際のデータイメージ
```
メモの整理箱

┌────┬────────────┬──────────────────┬─────────────────┬─────────────────┐
│ID  │   タイトル    │      内容         │    作成日時      │    更新日時      │
├────┼────────────┼──────────────────┼─────────────────┼─────────────────┤
│ 1  │ 買い物リスト   │ 牛乳、パン、卵     │ 2024-01-15 10:30│ 2024-01-15 10:30│
│ 2  │ 勉強予定      │ 数学の宿題、英単語  │ 2024-01-15 14:20│ 2024-01-15 15:45│
│ 3  │ 映画メモ      │ アクション映画     │ 2024-01-16 20:15│ 2024-01-16 20:15│
└────┴────────────┴──────────────────┴─────────────────┴─────────────────┘
```

## CRUD操作 = 「基本的な4つの作業」

### Create（作成）= 「新しい引き出しに物を入れる」
```sql
INSERT INTO memos (title, content) VALUES ('買い物リスト', '牛乳、パン、卵');
```
**結果**: 新しいメモが追加される

### Read（読取）= 「引き出しから物を取り出して見る」
```sql
-- 全部のメモを見る
SELECT * FROM memos;

-- 特定のメモだけ見る
SELECT * FROM memos WHERE id = 1;

-- タイトルに「買い物」が含まれるメモを見る
SELECT * FROM memos WHERE title LIKE '%買い物%';
```

### Update（更新）= 「引き出しの中身を入れ替える」
```sql
UPDATE memos SET content = '牛乳、パン、卵、チーズ' WHERE id = 1;
```
**結果**: ID1のメモの内容が変更される

### Delete（削除）= 「引き出しから物を捨てる」
```sql
DELETE FROM memos WHERE id = 1;
```
**結果**: ID1のメモが完全に削除される

## better-sqlite3 = 「自動化された司書さん」

### Node.jsとSQLiteの橋渡し

#### 普通のSQL実行
```
あなた → SQL文を書く → データベースに送信 → 結果を受け取る
（手動で全部やる）
```

#### better-sqlite3使用
```javascript
const db = require('better-sqlite3')('memo_app.db');

// 自動化された司書さんに依頼
const stmt = db.prepare('SELECT * FROM memos WHERE id = ?');
const memo = stmt.get(1);  // ID1のメモを取得

console.log(memo);  // 結果が自動的に整形されて返ってくる
```

### 特徴

#### 1. 同期処理 = 「その場で即答」
```javascript
// ❌ 非同期（時間がかかる可能性）
const memo = await db.query('SELECT * FROM memos');

// ✅ 同期（すぐに結果が返ってくる）
const memo = stmt.get();
```

#### 2. 準備済み文 = 「定型業務の効率化」
```javascript
// 毎回同じような作業をする場合
const insertMemo = db.prepare('INSERT INTO memos (title, content) VALUES (?, ?)');

// 何度でも使い回し可能
insertMemo.run('メモ1', '内容1');
insertMemo.run('メモ2', '内容2');
insertMemo.run('メモ3', '内容3');
```

#### 3. セキュリティ = 「安全な依頼方法」
```javascript
// ❌ 危険（SQLインジェクション攻撃の可能性）
const query = `SELECT * FROM memos WHERE title = '${userInput}'`;

// ✅ 安全（プレースホルダー使用）
const stmt = db.prepare('SELECT * FROM memos WHERE title = ?');
const result = stmt.get(userInput);
```

## データの流れ

### 現在（ローカルストレージ）
```
ブラウザ → JavaScript → localStorage → ブラウザ

問題点:
- ブラウザを変えると消える
- 他の人と共有できない
- データが大きくなると遅くなる
```

### これから（SQLite）
```
ブラウザ → Express.js → SQLite → Express.js → ブラウザ

利点:
- サーバー再起動でも残る
- 複数のブラウザで共有可能
- 大量のデータでも高速
- 検索・並び替えが得意
```

## なぜSQLiteを選んだの？

### 学習効果
```
📚 データベースの基本を学ぶのに最適

1. 設定が簡単 → すぐに本題に集中できる
2. SQLの基本文法 → 他のDBでも使える知識
3. ファイル型 → 仕組みが理解しやすい
4. 軽量 → 個人プロジェクトに最適
```

### 実用性
```
💼 実際の開発現場でも使われている

• スマホアプリ（Android、iOS）の標準DB
• 小〜中規模のWebアプリケーション
• デスクトップアプリケーション
• IoTデバイス
• テスト環境
```

## 今日やること

### Step 1: データベースファイル作成
```
database/db.js → SQLite接続設定
memo_app.db → 実際のデータファイル（自動作成）
```

### Step 2: テーブル作成
```sql
CREATE TABLE memos (...);
```

### Step 3: CRUD関数作成
```javascript
function createMemo(title, content) { ... }
function getAllMemos() { ... }
function updateMemo(id, title, content) { ... }
function deleteMemo(id) { ... }
```

### Step 4: API Routes作成
```javascript
POST /api/memos → createMemo()
GET /api/memos → getAllMemos()
PUT /api/memos/:id → updateMemo()
DELETE /api/memos/:id → deleteMemo()
```

## まとめ

**SQLite は...**

1. **整理整頓された引き出し** - データを構造化して保存
2. **持ち運び可能** - 1つのファイルで完結
3. **SQL言語** - 標準的なデータベース言語を習得
4. **CRUD操作** - データの基本操作を学習
5. **実用的** - 実際の開発現場でも使用

今日でローカルストレージから卒業して、本格的なデータベースアプリケーションを作りましょう！🚀